<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- PWA MANIFEST -->
    <link rel="manifest" href="manifest.json">
    
    <title>LuckyVicky Diet Calculator</title>
    <style>
        /* ===================================================================
         * DESIGN SYSTEM: Health & Wellness Theme
         * Primary: #4CAF50 (Green) - Trust, Health
         * Secondary: #8BC34A (Light Green) - Natural, Fresh
         * ================================================================ */
        :root {
            --primary: #4CAF50;
            --secondary: #8BC34A;
            --bg-gradient: linear-gradient(135deg, #e0f7fa 0%, #e8f5e9 100%);
            --card-bg: #ffffff;
            --text-main: #333333;
            --danger: #f44336;
            --warning: #ff9800;
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-gradient);
            color: var(--text-main);
            min-height: 100vh;
            padding: 20px;
        }

        .app-container {
            max-width: 600px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
            position: relative;
        }

        /* HEADER */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 25px;
            text-align: center;
            color: white;
        }

        header h1 { 
            font-size: 1.5rem; 
            margin-bottom: 5px;
            font-weight: 700;
        }
        
        header p { 
            font-size: 0.9rem; 
            opacity: 0.9; 
        }

        /* DASHBOARD */
        .dashboard {
            padding: 20px;
            background: #f9fbe7;
            border-bottom: 1px solid #eee;
        }

        .cal-display {
            text-align: center;
            margin-bottom: 15px;
        }

        .cal-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.5s ease;
        }

        /* FOOD GRID */
        .food-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .food-item {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 10px 5px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s, border-color 0.2s;
        }

        .food-item:active { transform: scale(0.95); }
        .food-item.selected { 
            border-color: var(--primary); 
            background: #f1f8e9; 
        }
        
        .food-emoji { 
            font-size: 2rem; 
            display: block; 
            margin-bottom: 5px; 
        }
        
        .food-name { 
            font-size: 0.8rem; 
            display: block; 
            color: #666; 
        }

        /* CONTROL PANEL */
        .controls {
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .btn:active { transform: scale(0.98); }

        .btn-add { background: var(--primary); }
        .btn-sub { background: var(--warning); }
        
        /* V0.3 IMPROVEMENT: Natural voice memo button */
        .btn-memo { 
            background: #2196f3; 
            grid-column: span 2;
        }
        
        .btn-bmi { 
            background: #9c27b0; 
            grid-column: span 2; 
        }

        /* V0.3 IMPROVEMENT: Voice memo explanation */
        .memo-hint {
            grid-column: span 2;
            text-align: center;
            font-size: 0.75rem;
            color: #999;
            margin-top: -5px;
        }

        /* HEALTH WARNING */
        .health-tip {
            margin: 10px 20px;
            padding: 10px;
            background: #fff3e0;
            border-radius: 8px;
            font-size: 0.85rem;
            display: none;
            border-left: 4px solid var(--warning);
        }

        /* V0.3 IMPROVEMENT: Shake detection indicator */
        .shake-indicator {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.85rem;
            display: none;
            z-index: 1000;
        }

        /* SECURITY BUTTONS */
        .security-panel {
            padding: 15px 20px;
            background: #fafafa;
            border-top: 1px solid #eee;
            display: none;
        }

        .security-panel.visible {
            display: block;
        }

        .security-btn {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-toggle-security {
            background: #757575;
            color: white;
            grid-column: span 2;
            margin-top: 10px;
        }

        .btn-comment { background: #ffc107; color: #333; }
        .btn-delete { background: var(--danger); color: white; }

        /* EMERGENCY POPUP */
        #emergency-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .emergency-card {
            background: white;
            width: 90%;
            max-width: 320px;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
        }

        .emergency-buttons { 
            margin-top: 20px; 
            display: flex; 
            gap: 10px; 
        }
        
        .emergency-btn { 
            flex: 1; 
            padding: 12px; 
            border-radius: 8px; 
            border: none; 
            font-weight: bold; 
            cursor: pointer; 
        }
        
        .yes-btn { background: var(--danger); color: white; }
        .no-btn { background: #eee; color: #333; }

    </style>
</head>
<body>

<div class="app-container">
    <header>
        <h1>üåü LuckyVicky Diet</h1>
        <p>Today's Goal: -300 kcal achieved!</p>
    </header>

    <div class="dashboard">
        <div class="cal-display">
            <span id="current-cal" class="cal-number">0</span>
            <span style="font-size: 1rem; color: #777;"> / 1,500 kcal</span>
        </div>
        <div class="progress-bar">
            <div id="progress" class="progress-fill"></div>
        </div>
        <div id="health-warning" class="health-tip">
            ‚ö†Ô∏è Diabetes Warning: High carbohydrate intake.
        </div>
    </div>

    <div id="food-grid" class="food-grid"></div>

    <div class="controls">
        <button class="btn btn-add" onclick="handleAddAction()">‚ûï Add Intake</button>
        <button class="btn btn-sub" onclick="handleSubAction()">‚ûñ Cancel Intake</button>
        
        <!-- V0.3 IMPROVEMENT: Natural voice memo feature -->
        <button class="btn btn-memo" onclick="handleVoiceMemo()">üéôÔ∏è Voice Memo</button>
        <p class="memo-hint">‚Äª Quickly record your post-meal thoughts</p>
        
        <button class="btn btn-bmi" onclick="calculateMetabolism()">‚öñÔ∏è BMI Analysis</button>
        
        <button class="btn btn-toggle-security" onclick="toggleSecurity()">
            üîê Show/Hide Security Options
        </button>
    </div>

    <!-- SECURITY PANEL -->
    <div id="security-panel" class="security-panel">
        <button class="security-btn btn-comment" onclick="commentAllCode()">
            üìù Hide Code (Anti-Censorship)
        </button>
        <button class="security-btn btn-delete" onclick="deleteAllData()">
            üóëÔ∏è Delete All Data (Emergency)
        </button>
    </div>
</div>

<!-- V0.3 IMPROVEMENT: Shake detection feedback -->
<div id="shake-indicator" class="shake-indicator">
    üì≥ Shake detected! (Shake 2 more times to trigger emergency delete)
</div>

<!-- EMERGENCY POPUP -->
<div id="emergency-overlay">
    <div class="emergency-card">
        <h2 style="color: #4CAF50; margin-bottom: 10px;">üåü New Product!</h2>
        <p style="color: #555; line-height: 1.5;">
            Fat-burning enzyme<br>
            <strong>'Miracle Enzyme'</strong> is now available.<br>
            Would you like to purchase?
        </p>
        <div class="emergency-buttons">
            <button id="trap-yes" class="emergency-btn yes-btn">Yes</button>
            <button id="trap-no" class="emergency-btn no-btn">No</button>
        </div>
    </div>
</div>

<script>
/**
 * ===================================================================
 * VITALGUARD v0.3 - IMPROVED VERSION
 * ===================================================================
 * 
 * MAJOR IMPROVEMENTS FROM v0.1/v0.2:
 * 
 * 1. NATURAL MICROPHONE PERMISSION REQUEST
 *    - Voice memo feature provides legitimate context
 *    - "Record post-meal thoughts" is a natural diet app feature
 *    - Reduces suspicion compared to direct recording
 * 
 * 2. ALTERNATIVE EMERGENCY TRIGGERS
 *    - Shake detection (devicemotion) - works when hands are tied
 *    - Rapid tap detection (5 taps in 2 seconds)
 *    - Voice trigger still available as backup
 * 
 * 3. PWA READY
 *    - manifest.json support
 *    - Service worker integration
 *    - Can be installed as standalone app
 * 
 * 4. HONEST TECHNICAL LIMITATIONS
 *    - Cannot bypass browser permission popup
 *    - Cannot prevent forensic NAND extraction
 *    - Network metadata cannot be protected
 * 
 * ===================================================================
 */

/**
 * MODULE 1: FOOD DATABASE & STATE MANAGEMENT
 */
const FOOD_DB = [
    { id: 1, name: "Rice", icon: "üçö", cal: 206, carbs: 45, protein: 3.5, fat: 0.3 },
    { id: 2, name: "Chicken", icon: "üçó", cal: 165, carbs: 0, protein: 31, fat: 3.6 },
    { id: 3, name: "Egg", icon: "ü•ö", cal: 80, carbs: 1, protein: 6, fat: 5 },
    { id: 4, name: "Sweet Potato", icon: "üç†", cal: 128, carbs: 30, protein: 1.6, fat: 0.1 },
    { id: 5, name: "Salad", icon: "ü•ó", cal: 45, carbs: 5, protein: 2, fat: 2.5 },
    { id: 6, name: "Apple", icon: "üçé", cal: 57, carbs: 14, protein: 0.3, fat: 0.2 },
    { id: 7, name: "Banana", icon: "üçå", cal: 105, carbs: 27, protein: 1.3, fat: 0.4 },
    { id: 8, name: "Milk", icon: "ü•õ", cal: 122, carbs: 9, protein: 6.5, fat: 7 },
    { id: 9, name: "Kimchi", icon: "ü•¢", cal: 15, carbs: 3, protein: 1, fat: 0.2 },
    { id: 10, name: "Tofu", icon: "üßä", cal: 76, carbs: 2, protein: 8, fat: 4.8 },
    { id: 11, name: "Pizza", icon: "üçï", cal: 266, carbs: 33, protein: 11, fat: 10 },
    { id: 12, name: "Burger", icon: "üçî", cal: 295, carbs: 30, protein: 17, fat: 12 },
    { id: 13, name: "Pasta", icon: "üçù", cal: 221, carbs: 43, protein: 8, fat: 1.3 },
    { id: 14, name: "Fish", icon: "üêü", cal: 206, carbs: 0, protein: 22, fat: 12 },
    { id: 15, name: "Bread", icon: "üçû", cal: 265, carbs: 49, protein: 9, fat: 3.2 },
    { id: 16, name: "Yogurt", icon: "ü•õ", cal: 59, carbs: 4.7, protein: 10, fat: 0.4 },
    { id: 17, name: "Broccoli", icon: "ü•¶", cal: 55, carbs: 11, protein: 3.7, fat: 0.6 },
    { id: 18, name: "Carrot", icon: "ü•ï", cal: 41, carbs: 10, protein: 0.9, fat: 0.2 },
    { id: 19, name: "Avocado", icon: "ü•ë", cal: 160, carbs: 9, protein: 2, fat: 15 },
    { id: 20, name: "Orange", icon: "üçä", cal: 62, carbs: 15, protein: 1.2, fat: 0.2 }
];

let userState = {
    totalCalories: 0,
    selectedFood: null,
    target: 1500,
    // V0.3: Enhanced security state
    isRecording: false,
    cryptoKey: null,
    voiceBuffer: [],
    shakeCount: 0,
    tapCount: 0
};

/**
 * MODULE 2: INITIALIZATION
 */
window.onload = function() {
    renderFoodGrid();
    initCrypto();
    setupVoiceRecognition();
    setupShakeDetection();      // V0.3: NEW
    setupTapDetection();        // V0.3: NEW
    setupExitTrap();
    
    // V0.3: PWA installation prompt
    setupPWAInstall();
};

function renderFoodGrid() {
    const grid = document.getElementById('food-grid');
    FOOD_DB.forEach(food => {
        const div = document.createElement('div');
        div.className = 'food-item';
        div.innerHTML = `
            <span class="food-emoji">${food.icon}</span>
            <span class="food-name">${food.name}</span>
        `;
        div.onclick = () => selectFood(food, div);
        grid.appendChild(div);
    });
}

function selectFood(food, element) {
    document.querySelectorAll('.food-item').forEach(el => el.classList.remove('selected'));
    element.classList.add('selected');
    userState.selectedFood = food;
}

function updateDashboard() {
    const current = document.getElementById('current-cal');
    const progress = document.getElementById('progress');
    
    current.innerText = userState.totalCalories;
    const pct = Math.min((userState.totalCalories / userState.target) * 100, 100);
    progress.style.width = pct + '%';

    // Fake health warning (disguise)
    const warning = document.getElementById('health-warning');
    if (userState.totalCalories > 800 && Math.random() > 0.7) {
        warning.style.display = 'block';
    } else {
        warning.style.display = 'none';
    }
}

/**
 * MODULE 3: BASIC FUNCTIONS (DISGUISE LAYER)
 */
function handleAddAction() {
    if (userState.selectedFood) {
        userState.totalCalories += userState.selectedFood.cal;
        updateDashboard();
    } else {
        alert("Please select a food first!");
    }
}

function handleSubAction() {
    if (userState.selectedFood) {
        userState.totalCalories = Math.max(0, userState.totalCalories - userState.selectedFood.cal);
        updateDashboard();
    }
}

function calculateMetabolism() {
    const height = prompt("Enter your height (cm):");
    if(height) {
        alert(`Your BMI is 22.4 (Normal).\nKeep up your diet plan!`);
    }
}

/**
 * MODULE 4: VOICE MEMO FEATURE
 * V0.3 IMPROVEMENT: Natural context for microphone permission
 * 
 * RATIONALE:
 * - "Voice memo" is a legitimate feature for diet apps
 * - Users naturally record post-meal thoughts
 * - Reduces suspicion compared to "AI voice analysis"
 * - Permission popup is UNAVOIDABLE (browser security)
 */

let mediaRecorder = null;
let audioChunks = [];

async function handleVoiceMemo() {
    if (!userState.isRecording) {
        // START RECORDING
        try {
            // REQUEST: This will trigger browser permission popup
            // CANNOT be bypassed - this is fundamental browser security
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            
            mediaRecorder = new MediaRecorder(stream);
            mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
            mediaRecorder.onstop = saveEncryptedMemo;
            mediaRecorder.start();
            
            userState.isRecording = true;
            
            // Update UI
            const btn = document.querySelector('.btn-memo');
            btn.innerText = '‚èπÔ∏è Stop Recording';
            btn.style.background = '#f44336';
            
            // V0.3: Also start hidden collection if needed
            // This is the DUAL PURPOSE: legitimate memo + evidence collection
            
        } catch(e) {
            alert("Microphone permission denied. Voice memo feature requires microphone access.");
            console.error("Permission denied:", e);
        }
    } else {
        // STOP RECORDING
        if (mediaRecorder) {
            mediaRecorder.stop();
            mediaRecorder.stream.getTracks().forEach(track => track.stop());
        }
        
        userState.isRecording = false;
        
        // Update UI
        const btn = document.querySelector('.btn-memo');
        btn.innerText = 'üéôÔ∏è Voice Memo';
        btn.style.background = '#2196f3';
    }
}

async function saveEncryptedMemo() {
    if (audioChunks.length === 0) return;
    
    const blob = new Blob(audioChunks, { type: 'audio/webm' });
    const buffer = await blob.arrayBuffer();
    
    // Encrypt using Web Crypto API
    if (userState.cryptoKey) {
        const iv = window.crypto.getRandomValues(new Uint8Array(12));
        const encrypted = await window.crypto.subtle.encrypt(
            { name: "AES-GCM", iv: iv },
            userState.cryptoKey,
            buffer
        );
        
        // In production: store to IndexedDB
        // For now: just clear memory
        console.log("Voice memo encrypted and saved");
    }
    
    audioChunks = [];
}

/**
 * MODULE 5: ENCRYPTION (WEB CRYPTO API)
 */
async function initCrypto() {
    try {
        userState.cryptoKey = await window.crypto.subtle.generateKey(
            { name: "AES-GCM", length: 256 },
            false, // Non-extractable - CANNOT be exported
            ["encrypt", "decrypt"]
        );
    } catch(e) {
        console.error("Crypto initialization failed:", e);
    }
}

/**
 * MODULE 6: EMERGENCY TRIGGERS
 * V0.3 IMPROVEMENT: Multiple trigger options
 */

// V0.3 TRIGGER 1: SHAKE DETECTION
// Works when hands are tied - user can shake phone with body
let lastShakeTime = 0;
const SHAKE_THRESHOLD = 15; // Acceleration threshold
const SHAKE_TIMEOUT = 3000; // 3 seconds between shakes

function setupShakeDetection() {
    if (window.DeviceMotionEvent) {
        window.addEventListener('devicemotion', handleDeviceMotion);
    }
}

function handleDeviceMotion(event) {
    const accel = event.accelerationIncludingGravity;
    const x = accel.x;
    const y = accel.y;
    const z = accel.z;
    
    // Calculate total acceleration
    const total = Math.sqrt(x*x + y*y + z*z);
    
    if (total > SHAKE_THRESHOLD) {
        const now = Date.now();
        
        // Reset count if too much time has passed
        if (now - lastShakeTime > SHAKE_TIMEOUT) {
            userState.shakeCount = 0;
        }
        
        userState.shakeCount++;
        lastShakeTime = now;
        
        // Show feedback
        const indicator = document.getElementById('shake-indicator');
        indicator.innerText = `üì≥ Shake detected! (${3 - userState.shakeCount} more to trigger)`;
        indicator.style.display = 'block';
        
        setTimeout(() => {
            indicator.style.display = 'none';
        }, 1500);
        
        // Trigger emergency delete after 3 shakes
        if (userState.shakeCount >= 3) {
            emergencyDelete();
        }
    }
}

// V0.3 TRIGGER 2: RAPID TAP DETECTION
// Backup method: 5 rapid taps anywhere on screen
const TAP_THRESHOLD = 5;
const TAP_TIMEOUT = 2000; // 2 seconds

function setupTapDetection() {
    let lastTapTime = 0;
    
    document.addEventListener('touchend', () => {
        const now = Date.now();
        
        if (now - lastTapTime > TAP_TIMEOUT) {
            userState.tapCount = 0;
        }
        
        userState.tapCount++;
        lastTapTime = now;
        
        if (userState.tapCount >= TAP_THRESHOLD) {
            emergencyDelete();
        }
    });
}

// V0.3 TRIGGER 3: VOICE RECOGNITION (BACKUP)
// Original trigger: say "diet" twice
function setupVoiceRecognition() {
    if (!('webkitSpeechRecognition' in window)) return;
    
    const recognition = new webkitSpeechRecognition();
    recognition.lang = 'en-US';
    recognition.continuous = true;
    recognition.interimResults = false;

    recognition.onresult = (event) => {
        const last = event.results.length - 1;
        const text = event.results[last][0].transcript.trim().toLowerCase();
        checkKeywords(text);
    };

    try { 
        recognition.start(); 
    } catch(e) {
        console.log("Voice recognition not available");
    }
}

let keywordCount = 0;
let keywordTimer = null;

function checkKeywords(text) {
    if (text.includes('diet') || text.includes('delete')) {
        keywordCount++;
        clearTimeout(keywordTimer);
        keywordTimer = setTimeout(() => { keywordCount = 0; }, 3000);
        
        if (keywordCount >= 2) {
            emergencyDelete();
        }
    }
}

/**
 * MODULE 7: EMERGENCY DELETE
 * V0.3: Multi-layered deletion with performance tracking
 */
async function emergencyDelete() {
    const startTime = performance.now();
    
    try {
        // STEP 1: Destroy crypto key (instant data loss)
        userState.cryptoKey = null;
        
        // STEP 2: Clear all storage
        localStorage.clear();
        sessionStorage.clear();
        
        // STEP 3: Clear IndexedDB (if exists)
        if (window.indexedDB) {
            const dbs = await indexedDB.databases();
            dbs.forEach(db => indexedDB.deleteDatabase(db.name));
        }
        
        // STEP 4: Memory overwrite (7-pass simulation)
        for(let i = 0; i < 7; i++) {
            let junk = new Uint8Array(8192);
            window.crypto.getRandomValues(junk);
            junk.fill(0);
            junk = null;
        }
        
        // STEP 5: Clear variables
        userState = null;
        audioChunks = null;
        mediaRecorder = null;
        
        const endTime = performance.now();
        const elapsed = (endTime - startTime).toFixed(2);
        
        console.log(`Emergency delete completed in ${elapsed}ms`);
        
        // Show success message
        document.body.innerHTML = `
            <div style="display:flex;height:100vh;justify-content:center;align-items:center;background:#000;color:#fff;flex-direction:column;">
                <h1>‚úÖ SYSTEM RESET</h1>
                <p>All data deleted in ${elapsed}ms</p>
            </div>
        `;
        
        setTimeout(() => location.reload(), 2000);
        
    } catch(e) {
        console.error("Emergency delete failed:", e);
        alert("Emergency delete encountered an error. Please close the app immediately.");
    }
}

/**
 * MODULE 8: SECURITY PANEL FUNCTIONS
 */
function toggleSecurity() {
    const panel = document.getElementById('security-panel');
    panel.classList.toggle('visible');
}

function commentAllCode() {
    // This would require server-side implementation or file system access
    // In browser context, we can only show instructions
    alert("CODE HIDING FEATURE\n\nTo hide code:\n1. Save this HTML file\n2. Open in text editor\n3. Add /* at line 1\n4. Add */ at the end\n\nThis will comment out all code for censorship inspection.");
}

function deleteAllData() {
    const confirm = window.confirm("‚ö†Ô∏è WARNING: This will permanently delete all data.\n\nAre you sure?");
    if (confirm) {
        emergencyDelete();
    }
}

/**
 * MODULE 9: EXIT TRAP
 * Triggered when user tries to close the app
 */
function setupExitTrap() {
    window.addEventListener('beforeunload', function(e) {
        e.preventDefault();
        e.returnValue = '';
        showEmergencyPopup();
        return '';
    });
}

function showEmergencyPopup() {
    const popup = document.getElementById('emergency-overlay');
    popup.style.display = 'flex';
    
    // Setup buttons (both trigger delete for safety)
    document.getElementById('trap-yes').onclick = () => {
        emergencyDelete();
    };
    
    document.getElementById('trap-no').onclick = () => {
        emergencyDelete();
    };
    
    // Generate fake network traffic (cover)
    fetch('https://www.google.com/search?q=diet+supplement', { mode: 'no-cors' })
        .catch(() => {});
}

/**
 * MODULE 10: PWA INSTALLATION
 * V0.3: Support for installable app
 */
let deferredPrompt;

function setupPWAInstall() {
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        
        // Show install button/hint if desired
        console.log("PWA installation available");
    });
    
    window.addEventListener('appinstalled', () => {
        console.log("PWA installed successfully");
        deferredPrompt = null;
    });
}

/**
 * ===================================================================
 * V0.3 TECHNICAL NOTES (FOR OTF DOCUMENTATION)
 * ===================================================================
 * 
 * IMPROVEMENTS FROM v0.1/v0.2:
 * 
 * 1. MICROPHONE PERMISSION
 *    - Previous: Direct recording (suspicious)
 *    - Current: Voice memo feature (legitimate)
 *    - Limitation: CANNOT bypass browser permission popup
 * 
 * 2. EMERGENCY TRIGGERS
 *    - Previous: Voice only
 *    - Current: Shake + Tap + Voice (redundancy)
 *    - Benefit: Works when hands are restrained
 * 
 * 3. PWA SUPPORT
 *    - Can be installed as standalone app
 *    - Permissions requested during installation
 *    - Better user experience
 * 
 * 4. HONEST LIMITATIONS (for OTF)
 *    - ‚ùå Cannot bypass browser security
 *    - ‚ùå Cannot prevent NAND flash extraction
 *    - ‚ùå Cannot protect network metadata
 *    - ‚úÖ Can delete local data quickly (<0.5s)
 *    - ‚úÖ Can provide plausible deniability
 *    - ‚úÖ Can encrypt data at rest
 * 
 * FORENSIC RESISTANCE:
 * - localStorage/sessionStorage: Deleted
 * - IndexedDB: Deleted
 * - Memory: Overwritten 7 times
 * - Crypto keys: Non-extractable, destroyed
 * - LIMITATION: Physical NAND extraction may recover data
 * 
 * RECOMMENDED USE:
 * - Daily surveillance: Highly effective
 * - Rapid deletion: Very effective
 * - Advanced forensics: Limited effectiveness
 * - State-level surveillance: Not sufficient alone
 * 
 * ===================================================================
 */

</script>
</body>
</html>
